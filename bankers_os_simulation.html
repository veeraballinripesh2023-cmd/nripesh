<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>OS Concepts Visualizer — Banker's Algorithm</title>
<style>
:root{--bg:#0f1724;--panel:#0b1220;--accent:#06b6d4;--muted:#9aa4b2;--card:#0b1220}
*{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#071023);color:#e6eef6}
.app{display:grid;grid-template-columns:360px 1fr;gap:18px;padding:18px;height:100vh}
.sidebar{background:linear-gradient(180deg,var(--panel),#071022);padding:14px;border-radius:12px;overflow:auto}
.header{display:flex;gap:8px;align-items:center;margin-bottom:12px}
.header h1{font-size:16px;margin:0}
.row{display:flex;gap:8px;margin-bottom:8px}
.input,select,button{background:#071024;border:1px solid rgba(255,255,255,0.04);color:inherit;padding:8px;border-radius:8px}
.input[type=number]{width:84px}
.matrix{display:grid;gap:6px;margin-top:8px}
.controls{display:flex;gap:8px;align-items:center;margin-top:12px}
.playbtn{padding:8px 12px;border-radius:10px;background:linear-gradient(90deg,var(--accent),#3b82f6);border:none;color:#04202a}
.panel{background:linear-gradient(180deg,#071126,#031021);padding:12px;border-radius:12px}
.canvasWrap{background:linear-gradient(180deg,#061426,#00121a);border-radius:12px;padding:12px;height:100%;display:flex;flex-direction:column}
.canvasArea{flex:1;border-radius:10px;background:#02141b;padding:10px}
.footer{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
.stat{font-size:13px;color:var(--muted)}
.small{font-size:12px;color:var(--muted)}
button[disabled]{opacity:0.5}
.controls input[type=range]{width:140px}
.table{display:grid;gap:6px}
.badge{padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.03)}
.canvas{width:100%;height:100%;display:block}
.traceList{max-height:160px;overflow:auto;margin-top:8px}
.linkbtn{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:8px}
</style>
</head>
<body>
<div class="app">
<div class="sidebar panel">
<div class="header"><h1>Banker's Algorithm Simulator</h1></div>
<div class="row"><label class="small">Processes</label><input id="procCount" class="input" type="number" min="1" max="10" value="4"></div>
<div class="row"><label class="small">Resources</label><input id="resCount" class="input" type="number" min="1" max="6" value="3"></div>
<div class="row"><button id="build" class="input">Build Matrices</button><button id="rand" class="input">Randomize</button></div>
<div id="matrices"></div>
<div class="row"><button id="validate" class="input">Validate Input</button></div>
<div class="controls">
<button id="play" class="playbtn">Play</button>
<button id="pause" class="input">Pause</button>
<button id="stepF" class="input">Step ▶</button>
<button id="stepB" class="input">◀ Back</button>
<label class="small">Speed</label>
<input id="speed" type="range" min="0.2" max="2" step="0.1" value="1">
</div>
<div class="panel" style="margin-top:12px">
<div class="small">Execution Stats</div>
<div id="stats" class="stat">Ready</div>
</div>
<div class="panel" style="margin-top:12px">
<div class="small">Export</div>
<div class="row"><button id="screenshot" class="input">Download Screenshot</button><button id="downloadTrace" class="input">Download Trace</button></div>
</div>
</div>
<div class="canvasWrap">
<div class="canvasArea panel">
<canvas id="canvas" class="canvas"></canvas>
</div>
<div class="footer">
<div>
<div class="badge small">State: <span id="stateLabel">Idle</span></div>
</div>
<div>
<div class="small">Trace events: <span id="traceCount">0</span></div>
</div>
</div>
</div>
</div>
<script>
const app={procCount:4,resCount:3,allocation:[],max:[],available:[],need:[],safeSeq:[],running:false,history:[],stepIndex:-1,speed:1}
const canvas=document.getElementById('canvas')
const ctx=canvas.getContext('2d')
function resize(){canvas.width=canvas.clientWidth*devicePixelRatio;canvas.height=canvas.clientHeight*devicePixelRatio;ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);render()}
addEventListener('resize',resize)
document.getElementById('build').addEventListener('click',()=>{app.procCount=clampInt('procCount',1,10);app.resCount=clampInt('resCount',1,6);buildMatrices();render();updateStats('Matrices built')})
document.getElementById('rand').addEventListener('click',()=>{randomize();render();updateStats('Randomized matrices')})
document.getElementById('validate').addEventListener('click',()=>{computeNeed();const ok=validate();if(ok)updateStats('Validation OK')})
document.getElementById('play').addEventListener('click',()=>start())
document.getElementById('pause').addEventListener('click',()=>pause())
document.getElementById('stepF').addEventListener('click',()=>step(1))
document.getElementById('stepB').addEventListener('click',()=>step(-1))
document.getElementById('screenshot').addEventListener('click',downloadScreenshot)
document.getElementById('downloadTrace').addEventListener('click',downloadTrace)
document.getElementById('speed').addEventListener('input',e=>{app.speed=parseFloat(e.target.value)})
function clampInt(id,min,max){const v=parseInt(document.getElementById(id).value)||min;return Math.min(max,Math.max(min,v))}
function buildMatrices(){const p=app.procCount,r=app.resCount;app.allocation=Array.from({length:p},()=>Array.from({length:r},()=>0));app.max=Array.from({length:p},()=>Array.from({length:r},()=>0));app.available=Array.from({length:r},()=>Math.max(1,Math.floor(Math.random()*3)+1));renderMatricesUI()}
function renderMatricesUI(){const container=document.getElementById('matrices');container.innerHTML='';const p=app.procCount,r=app.resCount;const table=document.createElement('div');table.className='table';const allocLabel=document.createElement('div');allocLabel.textContent='Allocation';table.appendChild(allocLabel);const allocGrid=document.createElement('div');allocGrid.className='matrix';allocGrid.style.gridTemplateColumns=`repeat(${r},1fr)`;for(let i=0;i<p;i++){for(let j=0;j<r;j++){const inp=document.createElement('input');inp.type='number';inp.min='0';inp.value=app.allocation[i][j];inp.className='input';inp.dataset.a='alloc';inp.dataset.i=i;inp.dataset.j=j;inp.addEventListener('input',e=>{app.allocation[+e.target.dataset.i][+e.target.dataset.j]=Math.max(0,parseInt(e.target.value)||0)});allocGrid.appendChild(inp)}}table.appendChild(allocGrid);const maxLabel=document.createElement('div');maxLabel.textContent='Max';table.appendChild(maxLabel);const maxGrid=document.createElement('div');maxGrid.className='matrix';maxGrid.style.gridTemplateColumns=`repeat(${r},1fr)`;for(let i=0;i<p;i++){for(let j=0;j<r;j++){const inp=document.createElement('input');inp.type='number';inp.min='0';inp.value=app.max[i][j];inp.className='input';inp.dataset.a='max';inp.dataset.i=i;inp.dataset.j=j;inp.addEventListener('input',e=>{app.max[+e.target.dataset.i][+e.target.dataset.j]=Math.max(0,parseInt(e.target.value)||0)}) ;maxGrid.appendChild(inp)}}table.appendChild(maxGrid);const availLabel=document.createElement('div');availLabel.textContent='Available';table.appendChild(availLabel);const availRow=document.createElement('div');availRow.className='matrix';availRow.style.gridTemplateColumns=`repeat(${r},1fr)`;for(let j=0;j<r;j++){const inp=document.createElement('input');inp.type='number';inp.min='0';inp.value=app.available[j];inp.className='input';inp.dataset.a='avail';inp.dataset.j=j;inp.addEventListener('input',e=>{app.available[+e.target.dataset.j]=Math.max(0,parseInt(e.target.value)||0)}) ;availRow.appendChild(inp)}table.appendChild(availRow);container.appendChild(table)}
function randomize(){const p=app.procCount,r=app.resCount;app.allocation=Array.from({length:p},()=>Array.from({length:r},()=>Math.floor(Math.random()*3)));app.max=Array.from({length:p},()=>Array.from({length:r},()=>Math.floor(Math.random()*5)));app.available=Array.from({length:r},()=>Math.floor(Math.random()*4)+1);renderMatricesUI();computeNeed()}
function computeNeed(){const p=app.procCount,r=app.resCount;app.need=Array.from({length:p},()=>Array.from({length:r},()=>0));for(let i=0;i<p;i++){for(let j=0;j<r;j++){app.need[i][j]=Math.max(0,app.max[i][j]-app.allocation[i][j])}}}
function validate(){computeNeed();for(let j=0;j<app.resCount;j++){let sum=0;for(let i=0;i<app.procCount;i++)sum+=app.allocation[i][j];if(sum>app.available[j]+sum){}}
return true}
function isSafe(){computeNeed();const work=app.available.slice();const finish=Array.from({length:app.procCount},()=>false);const seq=[];let progress=true;while(progress){progress=false;for(let i=0;i<app.procCount;i++)if(!finish[i]){let ok=true;for(let j=0;j<app.resCount;j++)if(app.need[i][j]>work[j]){ok=false;break}if(ok){for(let j=0;j<app.resCount;j++)work[j]+=app.allocation[i][j];finish[i]=true;seq.push(i);progress=true}}}
const all=finish.every(Boolean);app.safeSeq=all?seq:[];return all}
function start(){if(app.running)return;computeNeed();const ok=isSafe();if(!ok){updateStats('System not in safe state');return}app.running=true;document.getElementById('stateLabel').textContent='Playing';app.history=[];app.stepIndex=-1;recordState('start');playLoop()}
function pause(){app.running=false;document.getElementById('stateLabel').textContent='Paused'}
function playLoop(){if(!app.running)return;step(1);setTimeout(()=>{if(app.running)playLoop()},1000/app.speed)}
function step(dir){if(dir>0){const acted=attemptAllocateNext();if(acted)updateStats('Allocated to process '+acted);else updateStats('No allocatable process found');recordState('step') }else{undoStep()}render();document.getElementById('traceCount').textContent=app.history.length}
function attemptAllocateNext(){for(let i=0;i<app.procCount;i++){let can=true;for(let j=0;j<app.resCount;j++)if(app.need[i][j]>app.available[j]){can=false;break}if(can&&app.need[i].some(v=>v>0)){for(let j=0;j<app.resCount;j++){app.available[j]-=app.need[i][j];app.allocation[i][j]+=app.need[i][j];app.need[i][j]=0}return i}}return null}
function recordState(ev){const snap={time:new Date().toISOString(),allocation:app.allocation.map(r=>r.slice()),max:app.max.map(r=>r.slice()),available:app.available.slice(),need:app.need.map(r=>r.slice()),event:ev};app.history.push(snap);document.getElementById('traceCount').textContent=app.history.length}
function undoStep(){if(app.history.length<2)return;app.history.pop();const last=app.history[app.history.length-1];app.allocation=last.allocation.map(r=>r.slice());app.max=last.max.map(r=>r.slice());app.available=last.available.slice();app.need=last.need.map(r=>r.slice());updateStats('Reverted');render();document.getElementById('traceCount').textContent=app.history.length}
function downloadTrace(){const blob=new Blob([JSON.stringify(app.history,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='banker_trace.json';a.click();URL.revokeObjectURL(a.href)}
function downloadScreenshot(){const link=document.createElement('a');canvas.toBlob(blob=>{const url=URL.createObjectURL(blob);link.href=url;link.download='banker_screenshot.png';link.click();URL.revokeObjectURL(url)})}
function updateStats(t){document.getElementById('stats').textContent=t}
function render(){ctx.clearRect(0,0,canvas.width,canvas.height);drawBackground();drawResources();drawProcesses();}
function drawBackground(){ctx.fillStyle='#02141b';ctx.fillRect(0,0,canvas.width,canvas.height)}
function drawResources(){const pad=20;const rW=canvas.width/2-pad;const x=pad;const y=20;const h=80;const r=app.resCount;const boxW=(rW-(r-1)*10)/r;for(let j=0;j<r;j++){const bx=x+j*(boxW+10);ctx.fillStyle='#05232b';ctx.fillRect(bx,y,boxW,h);ctx.fillStyle='#9aa4b2';ctx.font='14px sans-serif';ctx.fillText('R'+j, bx+8, y+20);ctx.fillText('Avail: '+(app.available[j]||0), bx+8, y+45)} }
function drawProcesses(){const p=app.procCount;const cols= Math.ceil(Math.sqrt(p));const boxSize=110;const gap=18;const startX=20;const startY=140;for(let i=0;i<p;i++){const col=i%cols;const row=Math.floor(i/cols);const x=startX+col*(boxSize+gap);const y=startY+row*(boxSize+gap);ctx.fillStyle='#04202a';ctx.fillRect(x,y,boxSize,boxSize,8);ctx.fillStyle='#e6eef6';ctx.font='14px sans-serif';ctx.fillText('P'+i, x+8, y+18);const state=isFinished(i)?'Finished':canRun(i)?'Runnable':'Waiting';ctx.fillStyle=state==='Finished'? '#16a34a':state==='Runnable'?'#f59e0b':'#cbd5e1';ctx.fillText(state, x+8, y+38);ctx.font='12px monospace';for(let j=0;j<app.resCount;j++){ctx.fillStyle='#9aa4b2';ctx.fillText('R'+j+': A'+(app.allocation[i][j]||0)+' M'+(app.max[i][j]||0)+' N'+(app.need[i][j]||0), x+8, y+58+12*j)}}}
function isFinished(i){return app.need[i] && app.need[i].every(v=>v===0)}
function canRun(i){if(!app.need[i])return false;for(let j=0;j<app.resCount;j++)if(app.need[i][j]>app.available[j])return false;return true}
resize()
buildMatrices()
</script>
</body>
</html>
